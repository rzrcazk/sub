import re

# å®šä¹‰ä¸€ä¸ªå‡½æ•°æ¥è½¬æ¢è§„åˆ™é›†åˆ°Clash Metaçš„rule-providers
def convert_rules_to_meta(rules_content):
    # åˆ†å‰²æ¯è¡Œæ¥å¤„ç†
    rules_lines = rules_content.strip().split("\n")
    converted_rules = []

    # æ­£åˆ™è¡¨è¾¾å¼åŒ¹é…è§„åˆ™è¡Œ
    rule_pattern = re.compile(r'^ruleset=(.+?),(.+?):(.+)$')

    for line in rules_lines:
        if line.startswith(';') or not line:  # è·³è¿‡æ³¨é‡Šå’Œç©ºè¡Œ
            continue

        match = rule_pattern.match(line)
        if not match:
            continue

        # æå–è§„åˆ™é›†åç§°ã€ç±»å‹å’ŒURL
        group_name, rule_type, url = match.groups()
        rule_name = group_name.strip().split(' ')[-1]  # ä½¿ç”¨ç©ºæ ¼åçš„éƒ¨åˆ†ä½œä¸ºè§„åˆ™åç§°

        # æ„å»ºClash Metaè§„åˆ™æä¾›è€…æ ¼å¼
        rule_provider = {
            'type': 'http',
            'behavior': 'classical' if 'clash-classic' in rule_type else 'domain',
            'path': f"./ruleset/{rule_name}.yaml",
            'url': url,
            'interval': 86400,
        }
        converted_rules.append({rule_name: rule_provider})

    return converted_rules

# ä½ æä¾›çš„è§„åˆ™é›†å­—ç¬¦ä¸²å†…å®¹
rules_content = """
;è®¾ç½®è§„åˆ™æ ‡å¿—ä½
ruleset=ğŸ‘¨â€ğŸ’» GitHub,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GitHub/GitHub.yaml
ruleset=ğŸ¯ å›½å†…æµé‡,https://github.juanshen.eu.org/https://raw.githubusercontent.com/cutethotw/ClashRule/main/Rule/Inside.list
ruleset=ğŸš€ å›½å¤–æµé‡,https://github.juanshen.eu.org/https://raw.githubusercontent.com/cutethotw/ClashRule/main/Rule/Outside.list
ruleset=ğŸ§š ChatGPT,https://github.juanshen.eu.org/https://raw.githubusercontent.com/cutethotw/ClashRule/main/Rule/ChatGPT.list
ruleset=ğŸ§š ChatGPT,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/OpenAI/OpenAI.yaml
ruleset=ğŸ¯ å›½å†…æµé‡,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Lan/Lan.yaml
ruleset=ğŸ¯ å›½å†…æµé‡,https://github.juanshen.eu.org/https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/UnBan.list
ruleset=ğŸš€ å›½å¤–æµé‡,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/PikPak/PikPak.yaml
ruleset=ğŸ›¸ IPå½’å±åœ°ä¼ªè£…,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/lwd-temp/anti-ip-attribution/main/generated/rule-provider.yaml
;ruleset=ğŸ›‘ å¹¿å‘Šæ‹¦æˆª,https://github.juanshen.eu.org/https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanAD.list
;ruleset=ğŸ›‘ å¹¿å‘Šæ‹¦æˆª,https://github.juanshen.eu.org/https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanProgramAD.list
;ruleset=ğŸ›‘ å¹¿å‘Šæ‹¦æˆª,https://github.juanshen.eu.org/https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanEasyList.list
;ruleset=ğŸ›‘ å¹¿å‘Šæ‹¦æˆª,https://github.juanshen.eu.org/https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanEasyListChina.list
;ruleset=ğŸ›‘ å¹¿å‘Šæ‹¦æˆª,https://github.juanshen.eu.org/https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/BanEasyPrivacy.list
ruleset=ğŸ›‘ å¹¿å‘Šæ‹¦æˆª,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/ZhihuAds/ZhihuAds.yaml
ruleset=ğŸ“¹ YouTube,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/YouTube/YouTube.yaml
ruleset=ğŸ¥ Netflix,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Netflix/Netflix.yaml
ruleset=ğŸ¹ DisneyPlus,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Disney/Disney.yaml
ruleset=ğŸ“½ï¸ PrimeVideo,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/AmazonPrimeVideo/AmazonPrimeVideo.yaml
ruleset=ğŸ¦ HBOGO,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/HBOHK/HBOHK.yaml
ruleset=ğŸ¦ HBOGO,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/HBOAsia/HBOAsia.yaml
ruleset=ğŸ¦ HBOMAX,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/HBOUSA/HBOUSA.yaml
ruleset=ğŸ AppleTV,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/AppleTV/AppleTV.yaml
ruleset=ğŸ¬ EMBY,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/cutethotw/ClashRule/main/Rule/Emby.yaml
ruleset=ğŸ¬ EMBY,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Emby/Emby.yaml
ruleset=ğŸ“º å·´å“ˆå§†ç‰¹,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Bahamut/Bahamut.yaml
ruleset=ğŸ“º Bilibili,https://github.juanshen.eu.org/https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/BilibiliHMT.list
ruleset=ğŸ“º Bilibili,https://github.juanshen.eu.org/https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/Bilibili.list
ruleset=ğŸµ Spotify,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Spotify/Spotify.yaml
ruleset=ğŸ¶ TikTok,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/TikTok/TikTok.yaml
ruleset=ğŸŒ å›½å¤–åª’ä½“,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/GlobalMedia/GlobalMedia_Classical.yaml
ruleset=ğŸŒ å›½å†…åª’ä½“,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/ChinaMedia/ChinaMedia.yaml
ruleset=ğŸ“¢ è°·æ­ŒFCM,https://github.juanshen.eu.org/https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Ruleset/GoogleFCM.list
ruleset=ğŸ¯ å›½å†…æµé‡,https://github.juanshen.eu.org/https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/GoogleCN.list
ruleset=â“‚ï¸ å¾®è½¯äº‘ç›˜,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/OneDrive/OneDrive.yaml
ruleset=â“‚ï¸ å¾®è½¯æœåŠ¡,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Microsoft/Microsoft.yaml
ruleset=ğŸ è‹¹æœæœåŠ¡,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Apple/Apple.yaml
ruleset=ğŸ“² Telegram,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Telegram/Telegram.yaml
ruleset=ğŸ¤– Discord,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Discord/Discord.yaml
ruleset=ğŸ® æ¸¸æˆå¹³å°,clash-classic:https://github.juanshen.eu.org/https://raw.githubusercontent.com/blackmatrix7/ios_rule_script/master/rule/Clash/Game/Game.yaml
ruleset=ğŸš€ å›½å¤–æµé‡,https://github.juanshen.eu.org/https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ProxyGFWlist.list
ruleset=ğŸ¯ å›½å†…æµé‡,https://github.juanshen.eu.org/https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaDomain.list
ruleset=ğŸ¯ å›½å†…æµé‡,https://github.juanshen.eu.org/https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/ChinaCompanyIp.list
ruleset=ğŸ¯ å›½å†…æµé‡,https://github.juanshen.eu.org/https://raw.githubusercontent.com/ACL4SSR/ACL4SSR/master/Clash/Download.list
ruleset=ğŸ¯ å›½å†…æµé‡,[]GEOIP,CN
ruleset=ğŸŸ æ¼ç½‘ä¹‹é±¼,[]FINAL
...
;è®¾ç½®è§„åˆ™æ ‡å¿—ä½
"""

# è°ƒç”¨å‡½æ•°å¹¶æ‰“å°ç»“æœ
converted_rules = convert_rules_to_meta(rules_content)
print(converted_rules)

# å°†ç»“æœå†™å…¥åˆ°YAMLæ–‡ä»¶
import yaml
converted_yaml = yaml.safe_dump({"rule-providers": converted_rules}, sort_keys=False)

# å°†è½¬æ¢åçš„YAMLå†…å®¹å†™å…¥æ–‡ä»¶
output_path = './converted_clash_meta.yaml'
with open(output_path, 'w') as file:
    file.write(converted_yaml)

print(f"Converted Clash Meta configuration has been saved to {output_path}")
